<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>RITNOME CONGA ü•Å ‚Äî Train Your Rhythm Like a Boricua</title>
<meta name="description" content="Born in Puerto Rico. Powered by rhythm. Tap the conga, feel the beat, train your brain.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
    --gold:#FFD700;
    --orange:#FF6B35;
    --hot-pink:#FF1493;
    --tropical-teal:#00D9D9;
    --sunset:#FF8C42;
    --deep-purple:#2D1B4E;
    --warm-black:#1a0f0f;
    --cream:#FFF8E7;
}
*{margin:0;padding:0;box-sizing:border-box}
html,body{
    font-family:'Outfit',sans-serif;
    background:linear-gradient(135deg,var(--warm-black) 0%,var(--deep-purple) 50%,#1a0a2e 100%);
    color:var(--cream);
    min-height:100vh;
    min-height:100dvh;
    overflow-x:hidden;
}

/* Animated background particles */
.bg-particles{
    position:fixed;
    inset:0;
    pointer-events:none;
    overflow:hidden;
    z-index:0;
}
.particle{
    position:absolute;
    width:4px;
    height:4px;
    background:var(--gold);
    border-radius:50%;
    opacity:0.3;
    animation:float 8s ease-in-out infinite;
}
.particle:nth-child(2){left:20%;animation-delay:-2s;background:var(--hot-pink)}
.particle:nth-child(3){left:40%;animation-delay:-4s;background:var(--tropical-teal)}
.particle:nth-child(4){left:60%;animation-delay:-1s;background:var(--orange)}
.particle:nth-child(5){left:80%;animation-delay:-3s;background:var(--gold)}
.particle:nth-child(6){left:10%;animation-delay:-5s;background:var(--sunset)}
.particle:nth-child(7){left:70%;animation-delay:-6s;background:var(--hot-pink)}
.particle:nth-child(8){left:90%;animation-delay:-7s;background:var(--tropical-teal)}
@keyframes float{
    0%,100%{transform:translateY(100vh) scale(0);opacity:0}
    10%{opacity:0.6}
    90%{opacity:0.6}
    100%{transform:translateY(-100vh) scale(1);opacity:0}
}

.container{
    position:relative;
    z-index:1;
    max-width:500px;
    margin:0 auto;
    padding:20px;
    min-height:100vh;
    min-height:100dvh;
    display:flex;
    flex-direction:column;
}

/* Header */
.header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:10px 0;
    margin-bottom:20px;
}
.logo{
    font-family:'Bebas Neue',sans-serif;
    font-size:1.4rem;
    letter-spacing:2px;
    display:flex;
    align-items:center;
    gap:8px;
}
.logo-conga{color:var(--gold)}
.logo-ritnome{
    font-size:0.7rem;
    color:var(--cream);
    opacity:0.6;
    letter-spacing:1px;
}
.pr-flag{
    display:flex;
    gap:2px;
    padding:6px 10px;
    background:rgba(255,255,255,0.1);
    border-radius:20px;
}
.pr-stripe{width:4px;height:16px;border-radius:2px}
.pr-red{background:#ED0000}
.pr-white{background:#FFFFFF}
.pr-blue{background:#0050F0}

/* Hero */
.hero{
    text-align:center;
    padding:20px 0 30px;
}
.hero-emoji{
    font-size:4rem;
    animation:bounce 0.6s ease-in-out infinite;
    filter:drop-shadow(0 10px 30px rgba(255,107,53,0.5));
}
@keyframes bounce{
    0%,100%{transform:translateY(0)}
    50%{transform:translateY(-10px)}
}
.hero-title{
    font-family:'Bebas Neue',sans-serif;
    font-size:3rem;
    letter-spacing:4px;
    margin:15px 0 5px;
    background:linear-gradient(135deg,var(--gold),var(--orange),var(--hot-pink));
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    background-clip:text;
    animation:shimmer 3s linear infinite;
    background-size:200% auto;
}
@keyframes shimmer{0%{background-position:200% center}100%{background-position:-200% center}}
.hero-tagline{
    font-size:1rem;
    color:var(--cream);
    opacity:0.8;
    letter-spacing:2px;
    margin-bottom:5px;
}
.hero-sub{
    font-size:0.75rem;
    color:var(--tropical-teal);
    letter-spacing:3px;
    text-transform:uppercase;
}

/* Game Area */
.game-area{
    flex:1;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    padding:20px 0;
}

/* Conga Drum */
.conga-wrapper{
    position:relative;
    display:flex;
    flex-direction:column;
    align-items:center;
}
.conga-btn{
    width:180px;
    height:220px;
    background:linear-gradient(180deg,#FFD700 0%,#FF8C42 30%,#E65C00 70%,#CC4400 100%);
    border:none;
    border-radius:50% 50% 45% 45% / 30% 30% 50% 50%;
    cursor:pointer;
    position:relative;
    box-shadow:
        0 20px 60px rgba(255,107,53,0.5),
        inset 0 -30px 60px rgba(0,0,0,0.3),
        inset 0 10px 30px rgba(255,255,255,0.3);
    transition:transform 0.08s,box-shadow 0.08s;
    outline:none;
    -webkit-tap-highlight-color:transparent;
}
.conga-btn::before{
    content:'';
    position:absolute;
    top:0;
    left:50%;
    transform:translateX(-50%);
    width:85%;
    height:25%;
    background:linear-gradient(180deg,#FFF8E7 0%,#E8D5B0 50%,#D4BC8A 100%);
    border-radius:50%;
    box-shadow:inset 0 5px 15px rgba(0,0,0,0.2);
}
.conga-btn::after{
    content:'';
    position:absolute;
    top:8%;
    left:50%;
    transform:translateX(-50%);
    width:70%;
    height:15%;
    background:radial-gradient(ellipse,rgba(255,255,255,0.4) 0%,transparent 70%);
    border-radius:50%;
}
.conga-btn:active,.conga-btn.hit{
    transform:scale(0.95);
    box-shadow:
        0 10px 30px rgba(255,107,53,0.6),
        inset 0 -20px 40px rgba(0,0,0,0.4),
        inset 0 5px 20px rgba(255,255,255,0.2);
}
.conga-btn.perfect{
    box-shadow:
        0 0 60px var(--gold),
        0 20px 60px rgba(255,107,53,0.8),
        inset 0 -30px 60px rgba(0,0,0,0.3),
        inset 0 10px 30px rgba(255,255,255,0.3);
}

/* Ring pulse effect */
.ring{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    width:200px;
    height:200px;
    border:3px solid var(--gold);
    border-radius:50%;
    opacity:0;
    pointer-events:none;
}
.ring.pulse{
    animation:ringPulse 0.4s ease-out;
}
@keyframes ringPulse{
    0%{transform:translate(-50%,-50%) scale(0.8);opacity:1}
    100%{transform:translate(-50%,-50%) scale(1.5);opacity:0}
}

/* BPM Display */
.bpm-display{
    margin-top:25px;
    text-align:center;
}
.bpm-label{
    font-size:0.65rem;
    letter-spacing:3px;
    color:var(--cream);
    opacity:0.5;
    text-transform:uppercase;
}
.bpm-value{
    font-family:'Bebas Neue',sans-serif;
    font-size:2.5rem;
    color:var(--gold);
    letter-spacing:4px;
}
.bpm-value span{
    font-size:1rem;
    opacity:0.6;
}

/* Score Display */
.score-area{
    display:flex;
    justify-content:center;
    gap:30px;
    margin-top:20px;
}
.score-box{
    text-align:center;
    padding:15px 25px;
    background:rgba(255,255,255,0.05);
    border-radius:16px;
    border:1px solid rgba(255,215,0,0.2);
}
.score-label{
    font-size:0.6rem;
    letter-spacing:2px;
    color:var(--cream);
    opacity:0.5;
    text-transform:uppercase;
    margin-bottom:5px;
}
.score-value{
    font-family:'Bebas Neue',sans-serif;
    font-size:1.8rem;
    color:var(--gold);
}

/* Feedback */
.feedback{
    height:40px;
    display:flex;
    align-items:center;
    justify-content:center;
    margin-top:15px;
}
.feedback-text{
    font-family:'Bebas Neue',sans-serif;
    font-size:1.5rem;
    letter-spacing:4px;
    opacity:0;
    transition:opacity 0.1s;
}
.feedback-text.show{opacity:1}
.feedback-text.perfect{color:var(--gold);text-shadow:0 0 20px var(--gold)}
.feedback-text.good{color:var(--tropical-teal)}
.feedback-text.early{color:var(--orange)}
.feedback-text.late{color:var(--hot-pink)}
.feedback-text.miss{color:#ff4444}
.feedback-text.start{color:var(--cream);opacity:0.7;font-size:1rem}

/* Controls */
.controls{
    display:flex;
    flex-direction:column;
    gap:12px;
    margin-top:auto;
    padding:20px 0;
}
.start-btn{
    width:100%;
    padding:18px;
    border:none;
    border-radius:50px;
    font-family:'Bebas Neue',sans-serif;
    font-size:1.4rem;
    letter-spacing:4px;
    cursor:pointer;
    background:linear-gradient(135deg,var(--gold),var(--orange));
    color:var(--warm-black);
    box-shadow:0 8px 30px rgba(255,215,0,0.4);
    transition:all 0.3s;
}
.start-btn:active{transform:scale(0.98)}
.start-btn:disabled{opacity:0.5;cursor:not-allowed}
.start-btn.playing{
    background:linear-gradient(135deg,var(--hot-pink),#ff6b9d);
}

/* BPM Selector */
.bpm-selector{
    display:flex;
    gap:8px;
    justify-content:center;
}
.bpm-option{
    padding:12px 20px;
    border:2px solid rgba(255,215,0,0.3);
    border-radius:12px;
    background:transparent;
    color:var(--cream);
    font-family:'Bebas Neue',sans-serif;
    font-size:1rem;
    letter-spacing:2px;
    cursor:pointer;
    transition:all 0.2s;
}
.bpm-option:active{transform:scale(0.95)}
.bpm-option.active{
    border-color:var(--gold);
    background:rgba(255,215,0,0.15);
    color:var(--gold);
}

/* Footer */
.footer{
    text-align:center;
    padding:20px 0;
    border-top:1px solid rgba(255,255,255,0.1);
    margin-top:20px;
}
.footer-text{
    font-size:0.7rem;
    color:var(--cream);
    opacity:0.4;
    letter-spacing:1px;
}
.footer-text a{
    color:var(--gold);
    text-decoration:none;
}
.powered-by{
    display:inline-flex;
    align-items:center;
    gap:8px;
    margin-top:10px;
    padding:8px 16px;
    background:rgba(255,215,0,0.08);
    border:1px solid rgba(255,215,0,0.15);
    border-radius:20px;
}
.powered-dot{
    width:6px;
    height:6px;
    background:var(--gold);
    border-radius:50%;
    animation:pulse 1s ease-in-out infinite;
}
@keyframes pulse{0%,100%{opacity:0.3;transform:scale(0.8)}50%{opacity:1;transform:scale(1.2)}}
.powered-text{
    font-size:0.6rem;
    color:var(--cream);
    opacity:0.6;
    letter-spacing:1px;
}
.powered-text span{
    font-family:'Bebas Neue',sans-serif;
    font-size:0.8rem;
    color:var(--gold);
    letter-spacing:2px;
}

/* Beat indicator */
.beat-indicator{
    display:flex;
    gap:8px;
    justify-content:center;
    margin-top:15px;
}
.beat-dot{
    width:12px;
    height:12px;
    background:rgba(255,215,0,0.2);
    border-radius:50%;
    transition:all 0.1s;
}
.beat-dot.active{
    background:var(--gold);
    box-shadow:0 0 15px var(--gold);
    transform:scale(1.3);
}

/* Instructions overlay */
.instructions{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.9);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:100;
    padding:20px;
    opacity:0;
    pointer-events:none;
    transition:opacity 0.3s;
}
.instructions.show{opacity:1;pointer-events:auto}
.instructions-card{
    background:var(--deep-purple);
    border:2px solid var(--gold);
    border-radius:24px;
    padding:30px;
    max-width:350px;
    text-align:center;
}
.instructions-title{
    font-family:'Bebas Neue',sans-serif;
    font-size:1.8rem;
    color:var(--gold);
    letter-spacing:3px;
    margin-bottom:15px;
}
.instructions-text{
    font-size:0.85rem;
    color:var(--cream);
    opacity:0.8;
    line-height:1.6;
    margin-bottom:20px;
}
.instructions-btn{
    padding:14px 40px;
    border:none;
    border-radius:30px;
    background:linear-gradient(135deg,var(--gold),var(--orange));
    color:var(--warm-black);
    font-family:'Bebas Neue',sans-serif;
    font-size:1.1rem;
    letter-spacing:2px;
    cursor:pointer;
}

@media(min-width:400px){
    .hero-title{font-size:3.5rem}
    .conga-btn{width:200px;height:250px}
    .ring{width:220px;height:220px}
}
</style>
</head>
<body>

<div class="bg-particles">
    <div class="particle" style="left:5%"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
</div>

<div class="container">
    <header class="header">
        <div class="logo">
            <span class="logo-conga">ü•Å CONGA</span>
        </div>
        <div class="pr-flag">
            <div class="pr-stripe pr-red"></div>
            <div class="pr-stripe pr-white"></div>
            <div class="pr-stripe pr-blue"></div>
            <div class="pr-stripe pr-white"></div>
            <div class="pr-stripe pr-red"></div>
        </div>
    </header>

    <section class="hero">
        <div class="hero-emoji">ü•Å</div>
        <h1 class="hero-title">RITNOME CONGA</h1>
        <p class="hero-tagline">Train Your Rhythm</p>
        <p class="hero-sub">Born in Puerto Rico üáµüá∑</p>
    </section>

    <div class="game-area">
        <div class="conga-wrapper">
            <button class="conga-btn" id="congaBtn" aria-label="Tap the conga">
                <div class="ring" id="ring"></div>
            </button>
        </div>

        <div class="bpm-display">
            <div class="bpm-label">Tempo</div>
            <div class="bpm-value"><span id="currentBpm">90</span> <span>BPM</span></div>
        </div>

        <div class="beat-indicator">
            <div class="beat-dot" id="beat0"></div>
            <div class="beat-dot" id="beat1"></div>
            <div class="beat-dot" id="beat2"></div>
            <div class="beat-dot" id="beat3"></div>
        </div>

        <div class="score-area">
            <div class="score-box">
                <div class="score-label">Streak</div>
                <div class="score-value" id="streak">0</div>
            </div>
            <div class="score-box">
                <div class="score-label">Best</div>
                <div class="score-value" id="best">0</div>
            </div>
        </div>

        <div class="feedback">
            <div class="feedback-text" id="feedback"></div>
        </div>
    </div>

    <div class="controls">
        <div class="bpm-selector">
            <button class="bpm-option" data-bpm="60">60</button>
            <button class="bpm-option active" data-bpm="90">90</button>
            <button class="bpm-option" data-bpm="120">120</button>
        </div>
        <button class="start-btn" id="startBtn">ü•Å START</button>
    </div>

    <footer class="footer">
        <p class="footer-text">¬© 2025 <a href="https://gostar.digital">GoStar Digital LLC</a> üáµüá∑</p>
        <div class="powered-by">
            <div class="powered-dot"></div>
            <div class="powered-text">Powered by <span>RITNOME‚Ñ¢</span></div>
        </div>
    </footer>
</div>

<div class="instructions" id="instructions">
    <div class="instructions-card">
        <div class="instructions-title">HOW TO PLAY</div>
        <p class="instructions-text">
            Tap the conga drum ON THE BEAT! ü•Å<br><br>
            Watch the beat dots light up and tap in rhythm.<br><br>
            Build your streak. Feel the flow. Train your brain like a boricua! üáµüá∑
        </p>
        <button class="instructions-btn" id="gotItBtn">¬°PA'LANTE!</button>
    </div>
</div>

<script>
(function(){
    var congaBtn = document.getElementById('congaBtn');
    var startBtn = document.getElementById('startBtn');
    var ring = document.getElementById('ring');
    var feedback = document.getElementById('feedback');
    var streakEl = document.getElementById('streak');
    var bestEl = document.getElementById('best');
    var currentBpmEl = document.getElementById('currentBpm');
    var instructions = document.getElementById('instructions');
    var gotItBtn = document.getElementById('gotItBtn');
    var bpmOptions = document.querySelectorAll('.bpm-option');
    var beatDots = [
        document.getElementById('beat0'),
        document.getElementById('beat1'),
        document.getElementById('beat2'),
        document.getElementById('beat3')
    ];

    var bpm = 90;
    var beatInterval = null;
    var isPlaying = false;
    var beatIndex = 0;
    var lastBeatTime = 0;
    var streak = 0;
    var best = parseInt(localStorage.getItem('conga-best')) || 0;
    var feedbackTimeout = null;
    var audioCtx = null;

    bestEl.textContent = best;

    // Show instructions on first visit
    if (!localStorage.getItem('conga-seen')) {
        instructions.classList.add('show');
    }

    gotItBtn.onclick = function() {
        instructions.classList.remove('show');
        localStorage.setItem('conga-seen', 'true');
    };

    // BPM selection
    bpmOptions.forEach(function(btn) {
        btn.onclick = function() {
            if (isPlaying) return;
            bpmOptions.forEach(function(b) { b.classList.remove('active'); });
            btn.classList.add('active');
            bpm = parseInt(btn.dataset.bpm);
            currentBpmEl.textContent = bpm;
        };
    });

    // Audio - Realistic Conga Synthesis
    function initAudio() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
    }

    // Create noise buffer for slap attack
    var noiseBuffer = null;
    function createNoiseBuffer() {
        if (noiseBuffer || !audioCtx) return;
        var bufferSize = audioCtx.sampleRate * 0.1;
        noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
        var output = noiseBuffer.getChannelData(0);
        for (var i = 0; i < bufferSize; i++) {
            output[i] = Math.random() * 2 - 1;
        }
    }

    // Realistic conga hit
    function playConga(type) {
        if (!audioCtx) return;
        createNoiseBuffer();
        var now = audioCtx.currentTime;

        // Settings based on hit type
        var settings = {
            // Open tone - warm, resonant (tumba)
            open: { freq: 180, freqDecay: 120, attack: 0.005, decay: 0.25, volume: 0.6, noiseVol: 0.15 },
            // Slap - sharp, high (quinto) 
            slap: { freq: 350, freqDecay: 200, attack: 0.002, decay: 0.12, volume: 0.5, noiseVol: 0.4 },
            // Bass - deep thump
            bass: { freq: 100, freqDecay: 60, attack: 0.005, decay: 0.2, volume: 0.7, noiseVol: 0.1 },
            // Tap - light touch
            tap: { freq: 280, freqDecay: 180, attack: 0.002, decay: 0.08, volume: 0.3, noiseVol: 0.2 },
            // Perfect hit - bright and full
            perfect: { freq: 220, freqDecay: 140, attack: 0.003, decay: 0.3, volume: 0.7, noiseVol: 0.25 }
        };
        var s = settings[type] || settings.open;

        // Main body tone (sine)
        var osc = audioCtx.createOscillator();
        var oscGain = audioCtx.createGain();
        osc.type = 'sine';
        osc.frequency.setValueAtTime(s.freq, now);
        osc.frequency.exponentialRampToValueAtTime(s.freqDecay, now + s.decay);
        oscGain.gain.setValueAtTime(0, now);
        oscGain.gain.linearRampToValueAtTime(s.volume, now + s.attack);
        oscGain.gain.exponentialRampToValueAtTime(0.001, now + s.decay);
        osc.connect(oscGain);
        oscGain.connect(audioCtx.destination);
        osc.start(now);
        osc.stop(now + s.decay + 0.05);

        // Harmonic overtone
        var osc2 = audioCtx.createOscillator();
        var osc2Gain = audioCtx.createGain();
        osc2.type = 'sine';
        osc2.frequency.setValueAtTime(s.freq * 2.4, now);
        osc2.frequency.exponentialRampToValueAtTime(s.freqDecay * 1.5, now + s.decay * 0.5);
        osc2Gain.gain.setValueAtTime(0, now);
        osc2Gain.gain.linearRampToValueAtTime(s.volume * 0.3, now + s.attack);
        osc2Gain.gain.exponentialRampToValueAtTime(0.001, now + s.decay * 0.5);
        osc2.connect(osc2Gain);
        osc2Gain.connect(audioCtx.destination);
        osc2.start(now);
        osc2.stop(now + s.decay);

        // Noise for attack transient (slap sound)
        if (noiseBuffer) {
            var noise = audioCtx.createBufferSource();
            var noiseGain = audioCtx.createGain();
            var noiseFilter = audioCtx.createBiquadFilter();
            noise.buffer = noiseBuffer;
            noiseFilter.type = 'bandpass';
            noiseFilter.frequency.value = s.freq * 3;
            noiseFilter.Q.value = 1;
            noiseGain.gain.setValueAtTime(s.noiseVol, now);
            noiseGain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
            noise.connect(noiseFilter);
            noiseFilter.connect(noiseGain);
            noiseGain.connect(audioCtx.destination);
            noise.start(now);
            noise.stop(now + 0.05);
        }
    }

    // Beat metronome - subtle clave-style click
    function playBeat() {
        if (!audioCtx) return;
        var now = audioCtx.currentTime;
        var osc = audioCtx.createOscillator();
        var gain = audioCtx.createGain();
        osc.type = 'sine';
        osc.frequency.setValueAtTime(800, now);
        osc.frequency.exponentialRampToValueAtTime(400, now + 0.03);
        gain.gain.setValueAtTime(0.15, now);
        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start(now);
        osc.stop(now + 0.06);
    }

    function playHit(quality) {
        if (quality === 'perfect') {
            playConga('perfect');
        } else if (quality === 'good') {
            playConga('open');
        } else {
            playConga('tap');
        }
    }

    // Game loop
    function startGame() {
        initAudio();
        isPlaying = true;
        streak = 0;
        streakEl.textContent = 0;
        beatIndex = 0;
        startBtn.textContent = '‚èπ STOP';
        startBtn.classList.add('playing');
        bpmOptions.forEach(function(b) { b.style.pointerEvents = 'none'; b.style.opacity = '0.5'; });

        var interval = 60000 / bpm;
        
        function tick() {
            lastBeatTime = Date.now();
            beatDots.forEach(function(d) { d.classList.remove('active'); });
            beatDots[beatIndex].classList.add('active');
            playBeat();
            beatIndex = (beatIndex + 1) % 4;
        }

        tick();
        beatInterval = setInterval(tick, interval);
    }

    function stopGame() {
        isPlaying = false;
        clearInterval(beatInterval);
        beatInterval = null;
        startBtn.textContent = 'ü•Å START';
        startBtn.classList.remove('playing');
        bpmOptions.forEach(function(b) { b.style.pointerEvents = 'auto'; b.style.opacity = '1'; });
        beatDots.forEach(function(d) { d.classList.remove('active'); });
    }

    startBtn.onclick = function() {
        if (isPlaying) {
            stopGame();
        } else {
            startGame();
        }
    };

    // Tap handling
    function handleTap() {
        initAudio(); // Init audio on first interaction
        
        // Always show visual feedback
        ring.classList.remove('pulse');
        void ring.offsetWidth;
        ring.classList.add('pulse');
        congaBtn.classList.add('hit');
        setTimeout(function() {
            congaBtn.classList.remove('hit');
        }, 100);

        if (!isPlaying) {
            playHit('good');
            showFeedback('start');
            return;
        }

        var now = Date.now();
        var interval = 60000 / bpm;
        var timeSinceBeat = now - lastBeatTime;
        var timeToNextBeat = interval - timeSinceBeat;
        var tolerance = interval * 0.25;

        var quality;
        if (timeSinceBeat < tolerance || timeToNextBeat < tolerance) {
            if (timeSinceBeat < tolerance * 0.5 || timeToNextBeat < tolerance * 0.5) {
                quality = 'perfect';
                streak++;
            } else {
                quality = 'good';
                streak++;
            }
        } else if (timeSinceBeat < interval * 0.5) {
            quality = 'late';
            streak = 0;
        } else {
            quality = 'early';
            streak = 0;
        }

        if (quality === 'perfect') congaBtn.classList.add('perfect');
        setTimeout(function() {
            congaBtn.classList.remove('perfect');
        }, 100);

        playHit(quality);
        showFeedback(quality);
        streakEl.textContent = streak;

        if (streak > best) {
            best = streak;
            bestEl.textContent = best;
            localStorage.setItem('conga-best', best);
        }
    }

    function showFeedback(quality) {
        clearTimeout(feedbackTimeout);
        var text = quality === 'perfect' ? '¬°PERFECTO!' : 
                   quality === 'good' ? '¬°BUENO!' : 
                   quality === 'early' ? 'EARLY' : 
                   quality === 'late' ? 'LATE' :
                   quality === 'start' ? 'TAP START ‚Üì' : '';
        feedback.textContent = text;
        feedback.className = 'feedback-text show ' + quality;
        feedbackTimeout = setTimeout(function() {
            feedback.classList.remove('show');
        }, 400);
    }

    congaBtn.addEventListener('touchstart', function(e) {
        e.preventDefault();
        handleTap();
    }, { passive: false });

    congaBtn.addEventListener('mousedown', function(e) {
        e.preventDefault();
        handleTap();
    });

    // Prevent double-tap zoom on conga only
    congaBtn.addEventListener('touchend', function(e) {
        e.preventDefault();
    }, { passive: false });

    // Make sure buttons work on mobile
    startBtn.addEventListener('touchend', function(e) {
        e.preventDefault();
        startBtn.click();
    }, { passive: false });

    gotItBtn.addEventListener('touchend', function(e) {
        e.preventDefault();
        gotItBtn.click();
    }, { passive: false });

    bpmOptions.forEach(function(btn) {
        btn.addEventListener('touchend', function(e) {
            e.preventDefault();
            btn.click();
        }, { passive: false });
    });

})();
</script>
</body>
</html>